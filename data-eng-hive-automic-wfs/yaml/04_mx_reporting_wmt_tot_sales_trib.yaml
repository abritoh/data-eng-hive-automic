#==========================================================================================================================#
#==========================================================================================================================#
# FILE.......: ............................................................................................................#
# DESCRIPTION: WMT-MX Reporting Workflow...................................................................................#
# AUTHOR.....: ArBR 2021-0401..............................................................................................#
# PARAMETERS.: ............................................................................................................#
#...$hadoop_queue                   &HADOOP_QUEUE#                    intlprcincld.........................................#
#==========================================================================================================================#
Description: "WMT-MX Report By Tribe"
HiveQuery: "
SET hive.execution.engine=tez;
SET tez.queue.name=$hadoop_queue;
SET hive.tez.container.size=5120;
SET hive.tez.java.opts=-Xmx4096m;
SET tez.runtime.unordered.output.buffer.size-mb=512;
SET hive.auto.convert.join.noconditionaltask.size=128435456;
SET hive.exec.reducers.bytes.per.reducer=67108864;
SET hive.exec.dynamic.partition.mode=nonstrict;
SET hive.optimize.sort.dynamic.partition=true;
SET hive.exec.max.dynamic.partitions=10000;
SET hive.exec.max.dynamic.partitions.pernode=4000;
SET tez.task.timeout-ms=900000;
SET tez.grouping.min-size=32000000;
SET tez.grouping.max-size=128000000;
SET tez.grouping.split-waves=10.0;
SET mapreduce.input.fileinputformat.split.maxsize=67108864;
SET hive.exec.parallel=true;
SET hive.vectorized.execution.enabled=true;
SET hive.vectorized.execution.reduce.enabled=true;
SET hive.vectorized.execution.reduce.groupby.enabled=true;
SET hive.merge.tezfiles=true;
SET hive.merge.smallfiles.avgsize=128000000;
SET hive.merge.size.per.task=128000000;

CREATE TABLE IF NOT EXISTS $target_schema.$target_table_sales_trib
(    
     YEAR_NBR					 SMALLINT
    , MONTH_NBR					 SMALLINT
    , DAY_NBR					 SMALLINT
	, BANNER_CD					 CHAR(2)
    , BANNER_DESC				 VARCHAR(20)    
    , CAT_NBR					 SMALLINT
    , CAT_DESC					 VARCHAR(50)
    , TRIBE_NBR					 INT
    , TRIBE_DESC				 VARCHAR(50)
    , SQUAD_NBR					 INT
    , SQUAD_DESC				 VARCHAR(50)
	, DEPT_DESC					 VARCHAR(50)
	, DEPT_NBR					 SMALLINT
	, SALE_TYPE_IND              SMALLINT

	, SALE_CY_EQ_UNIT_AMT		 DECIMAL(19,2)
	, SALE_CY_TOT_UNIT_AMT		 DECIMAL(19,2)
	, SALE_CY_EQ_UNIT_QTY		 DECIMAL(19,2)
	, SALE_CY_TOT_UNIT_QTY		 DECIMAL(19,2)
	, SALE_COMP_LY_EQ_UNIT_AMT   DECIMAL(19,2)
	, SALE_COMP_LY_TOT_UNIT_AMT  DECIMAL(19,2)
	, SALE_COMP_LY_EQ_UNIT_QTY   DECIMAL(19,2)
	, SALE_COMP_LY_TOT_UNIT_QTY  DECIMAL(19,2)
	, SALE_CAL_LY_EQ_UNIT_AMT    DECIMAL(19,2)
	, SALE_CAL_LY_TOT_UNIT_AMT   DECIMAL(19,2)
	, SALE_CAL_LY_EQ_UNIT_QTY    DECIMAL(19,2)
	, SALE_CAL_LY_TOT_UNIT_QTY   DECIMAL(19,2)

    , SHIP_COST_CY_AMT			 DECIMAL(19,2) 
	, SHIP_COST_LY_AMT			 DECIMAL(19,2)
    , SHIP_RTL_CY_AMT			 DECIMAL(19,2)
	, SHIP_RTL_LY_AMT			 DECIMAL(19,2)
    
    , RTN_COST_CY_AMT			 DECIMAL(19,2)
	, RTN_COST_LY_AMT			 DECIMAL(19,2)
	, RTN_RTL_CY_AMT			 DECIMAL(19,2)	
	, RTN_RTL_LY_AMT			 DECIMAL(19,2)

	, DEC_CEDIS_CY_AMT			 DECIMAL(19,2)
	, DEC_CEDIS_LY_AMT			 DECIMAL(19,2)
	, THROW_AWAY_CY_AMT			 DECIMAL(19,2)
	, THROW_AWAY_LY_AMT			 DECIMAL(19,2)	

	, OFC_INC_CY_AMT			 DECIMAL(19,2)
	, PRICE_CHNG_TO_0_CY_AMT	 DECIMAL(19,2)
	, DONATIONS_CY_AMT			 DECIMAL(19,2)
	, DONATED_CY_AMT			 DECIMAL(19,2)
	, LQDTNS_CY_AMT				 DECIMAL(19,2)
	, ABSLT_CP_SHOP_CY_AMT		 DECIMAL(19,2)
	, EVENT_5000_CY_AMT			 DECIMAL(19,2)
	, MULTISAVING_CY_AMT		 DECIMAL(19,2)
	, NBB_CY_AMT				 DECIMAL(19,2)
	, OFC_SALES_CY_AMT			 DECIMAL(19,2)

	, OFC_INC_LY_AMT			 DECIMAL(19,2)
	, PRICE_CHNG_TO_0_LY_AMT	 DECIMAL(19,2)
	, DONATIONS_LY_AMT			 DECIMAL(19,2)
	, DONATED_LY_AMT			 DECIMAL(19,2)
	, LQDTNS_LY_AMT				 DECIMAL(19,2)
	, ABSLT_CP_SHOP_LY_AMT		 DECIMAL(19,2)
	, EVENT_5000_LY_AMT			 DECIMAL(19,2)
	, MULTISAVING_LY_AMT		 DECIMAL(19,2)
	, NBB_LY_AMT				 DECIMAL(19,2)
	, OFC_SALES_LY_AMT			 DECIMAL(19,2)

	, ONHAND_COST_LY_AMT		 DECIMAL(19,2) 
	, ONHAND_COST_CY_AMT		 DECIMAL(19,2) 	
	, INTRAN_COST_LY_AMT		 DECIMAL(19,2) 
	, INTRAN_COST_CY_AMT		 DECIMAL(19,2) 
	, INWH_COST_LY_AMT			 DECIMAL(19,2) 
	, INWH_COST_CY_AMT			 DECIMAL(19,2) 

	, CUST_LY_TOT_UNIT_QTY		 INT
	, CUST_CY_TOT_UNIT_QTY		 INT
	, CUST_LY_EQ_UNIT_QTY		 INT
	, CUST_CY_EQ_UNIT_QTY		 INT
	, TKT_SALE_LY_TOT_UNIT_AMT	 DECIMAL(19,2)
	, TKT_SALE_CY_TOT_UNIT_AMT	 DECIMAL(19,2)
	, TKT_SALE_LY_EQ_UNIT_AMT	 DECIMAL(19,2)
	, TKT_SALE_CY_EQ_UNIT_AMT	 DECIMAL(19,2)
	, TKT_LY_TOT_UNIT_QTY		 INT
	, TKT_CY_TOT_UNIT_QTY		 INT
	, TKT_LY_EQ_UNIT_QTY		 INT
	, TKT_CY_EQ_UNIT_QTY		 INT

	, VISIT_COMP_LY_DT			 DATE
    , VISIT_CAL_LY_DT			 DATE
)
PARTITIONED BY ( VISIT_CY_DT DATE )
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '\u0001'
STORED AS ORC
TBLPROPERTIES ('orc.compress'='SNAPPY', 'auto.purge'='true');

INSERT OVERWRITE TABLE $target_schema.$target_table_sales_trib
PARTITION (VISIT_CY_DT)

SELECT
     YEAR_NBR
    , MONTH_NBR
    , DAY_NBR
	, BANNER_CD
    , BANNER_DESC
    , CAT_NBR
    , CAT_DESC
    , TRIBE_NBR
    , TRIBE_DESC
    , SQUAD_NBR
    , SQUAD_DESC
    , DEPT_DESC
	, DEPT_NBR
	, SALE_TYPE_IND

	, SUM(SALE_CY_EQ_UNIT_AMT) AS SALE_CY_EQ_UNIT_AMT
	, SUM(SALE_CY_TOT_UNIT_AMT) AS SALE_CY_TOT_UNIT_AMT
	, SUM(SALE_CY_EQ_UNIT_QTY) AS SALE_CY_EQ_UNIT_QTY
	, SUM(SALE_CY_TOT_UNIT_QTY) AS SALE_CY_TOT_UNIT_QTY
	, SUM(SALE_COMP_LY_EQ_UNIT_AMT) AS SALE_COMP_LY_EQ_UNIT_AMT
	, SUM(SALE_COMP_LY_TOT_UNIT_AMT) AS SALE_COMP_LY_TOT_UNIT_AMT
	, SUM(SALE_COMP_LY_EQ_UNIT_QTY) AS SALE_COMP_LY_EQ_UNIT_QTY
	, SUM(SALE_COMP_LY_TOT_UNIT_QTY) AS SALE_COMP_LY_TOT_UNIT_QTY
	, SUM(SALE_CAL_LY_EQ_UNIT_AMT) AS SALE_CAL_LY_EQ_UNIT_AMT
	, SUM(SALE_CAL_LY_TOT_UNIT_AMT) AS SALE_CAL_LY_TOT_UNIT_AMT
	, SUM(SALE_CAL_LY_EQ_UNIT_QTY) AS SALE_CAL_LY_EQ_UNIT_QTY
	, SUM(SALE_CAL_LY_TOT_UNIT_QTY) AS SALE_CAL_LY_TOT_UNIT_QTY

    , SUM(SHIP_COST_CY_AMT) AS SHIP_COST_CY_AMT
    , SUM(SHIP_COST_LY_AMT) AS SHIP_COST_LY_AMT
    , SUM(SHIP_RTL_CY_AMT) AS SHIP_RTL_CY_AMT
    , SUM(SHIP_RTL_LY_AMT) AS SHIP_RTL_LY_AMT

    , SUM(RTN_COST_CY_AMT) AS RTN_COST_CY_AMT
    , SUM(RTN_RTL_CY_AMT) AS RTN_RTL_CY_AMT
    , SUM(RTN_COST_LY_AMT) AS RTN_COST_LY_AMT
    , SUM(RTN_RTL_LY_AMT) AS RTN_RTL_LY_AMT

    , SUM(DEC_CEDIS_CY_AMT) AS DEC_CEDIS_CY_AMT
    , SUM(DEC_CEDIS_LY_AMT) AS DEC_CEDIS_LY_AMT
    , SUM(THROW_AWAY_CY_AMT) AS THROW_AWAY_CY_AMT
    , SUM(THROW_AWAY_LY_AMT) AS THROW_AWAY_LY_AMT

	, SUM(OFC_INC_CY_AMT) AS OFC_INC_CY_AMT
	, SUM(PRICE_CHNG_TO_0_CY_AMT) AS PRICE_CHNG_TO_0_CY_AMT
	, SUM(DONATIONS_CY_AMT) AS DONATIONS_CY_AMT
	, SUM(DONATED_CY_AMT) AS DONATED_CY_AMT
	, SUM(LQDTNS_CY_AMT) AS LQDTNS_CY_AMT
	, SUM(ABSLT_CP_SHOP_CY_AMT) AS ABSLT_CP_SHOP_CY_AMT
	, SUM(EVENT_5000_CY_AMT) AS EVENT_5000_CY_AMT
	, SUM(MULTISAVING_CY_AMT) AS MULTISAVING_CY_AMT
	, SUM(NBB_CY_AMT) AS NBB_CY_AMT
	, SUM(OFC_SALES_CY_AMT) AS OFC_SALES_CY_AMT

	, SUM(OFC_INC_LY_AMT) AS OFC_INC_LY_AMT
	, SUM(PRICE_CHNG_TO_0_LY_AMT) AS PRICE_CHNG_TO_0_LY_AMT
	, SUM(DONATIONS_LY_AMT) AS DONATIONS_LY_AMT
	, SUM(DONATED_LY_AMT) AS DONATED_LY_AMT
	, SUM(LQDTNS_LY_AMT) AS LQDTNS_LY_AMT
	, SUM(ABSLT_CP_SHOP_LY_AMT) AS ABSLT_CP_SHOP_LY_AMT
	, SUM(EVENT_5000_LY_AMT) AS EVENT_5000_LY_AMT
	, SUM(MULTISAVING_LY_AMT) AS MULTISAVING_LY_AMT
	, SUM(NBB_LY_AMT) AS NBB_LY_AMT
	, SUM(OFC_SALES_LY_AMT) AS OFC_SALES_LY_AMT

	, SUM(ONHAND_COST_LY_AMT) AS ONHAND_COST_LY_AMT
	, SUM(ONHAND_COST_CY_AMT) AS ONHAND_COST_CY_AMT
	, SUM(INTRAN_COST_LY_AMT) AS INTRAN_COST_LY_AMT
	, SUM(INTRAN_COST_CY_AMT) AS INTRAN_COST_CY_AMT
	, SUM(INWH_COST_LY_AMT) AS INWH_COST_LY_AMT
	, SUM(INWH_COST_CY_AMT) AS INWH_COST_CY_AMT

	, SUM(CUST_LY_TOT_UNIT_QTY) AS CUST_LY_TOT_UNIT_QTY
	, SUM(CUST_CY_TOT_UNIT_QTY) AS CUST_CY_TOT_UNIT_QTY
	, SUM(CUST_LY_EQ_UNIT_QTY) AS CUST_LY_EQ_UNIT_QTY
	, SUM(CUST_CY_EQ_UNIT_QTY) AS CUST_CY_EQ_UNIT_QTY
	, SUM(TKT_SALE_LY_TOT_UNIT_AMT) AS TKT_SALE_LY_TOT_UNIT_AMT
	, SUM(TKT_SALE_CY_TOT_UNIT_AMT) AS TKT_SALE_CY_TOT_UNIT_AMT
	, SUM(TKT_SALE_LY_EQ_UNIT_AMT) AS TKT_SALE_LY_EQ_UNIT_AMT
	, SUM(TKT_SALE_CY_EQ_UNIT_AMT) AS TKT_SALE_CY_EQ_UNIT_AMT
	, SUM(TKT_LY_TOT_UNIT_QTY) AS TKT_LY_TOT_UNIT_QTY
	, SUM(TKT_CY_TOT_UNIT_QTY) AS TKT_CY_TOT_UNIT_QTY
	, SUM(TKT_LY_EQ_UNIT_QTY) AS TKT_LY_EQ_UNIT_QTY
	, SUM(TKT_CY_EQ_UNIT_QTY) AS TKT_CY_EQ_UNIT_QTY

	, VISIT_CAL_LY_DT 
	, VISIT_CAL_LY_DT AS VISIT_COMP_LY_DT
	, VISIT_CY_DT

FROM 
(
	SELECT
		 YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, DEPT_DESC
		, DEPT_NBR
		, SALE_TYPE_IND

		, SUM(SALE_CY_EQ_UNIT_AMT) AS SALE_CY_EQ_UNIT_AMT
		, SUM(SALE_CY_TOT_UNIT_AMT) AS SALE_CY_TOT_UNIT_AMT
		, SUM(SALE_CY_EQ_UNIT_QTY) AS SALE_CY_EQ_UNIT_QTY
		, SUM(SALE_CY_TOT_UNIT_QTY) AS SALE_CY_TOT_UNIT_QTY
		, SUM(SALE_COMP_LY_EQ_UNIT_AMT) AS SALE_COMP_LY_EQ_UNIT_AMT
		, SUM(SALE_COMP_LY_TOT_UNIT_AMT) AS SALE_COMP_LY_TOT_UNIT_AMT
		, SUM(SALE_COMP_LY_EQ_UNIT_QTY) AS SALE_COMP_LY_EQ_UNIT_QTY
		, SUM(SALE_COMP_LY_TOT_UNIT_QTY) AS SALE_COMP_LY_TOT_UNIT_QTY
		, SUM(SALE_CAL_LY_EQ_UNIT_AMT) AS SALE_CAL_LY_EQ_UNIT_AMT
		, SUM(SALE_CAL_LY_TOT_UNIT_AMT) AS SALE_CAL_LY_TOT_UNIT_AMT
		, SUM(SALE_CAL_LY_EQ_UNIT_QTY) AS SALE_CAL_LY_EQ_UNIT_QTY
		, SUM(SALE_CAL_LY_TOT_UNIT_QTY) AS SALE_CAL_LY_TOT_UNIT_QTY

		, 0 AS SHIP_COST_CY_AMT
		, 0 AS SHIP_COST_LY_AMT
		, 0 AS SHIP_RTL_CY_AMT
		, 0 AS SHIP_RTL_LY_AMT
    
		, 0 AS RTN_COST_CY_AMT
		, 0 AS RTN_COST_LY_AMT
		, 0 AS RTN_RTL_CY_AMT
		, 0 AS RTN_RTL_LY_AMT

		, 0 AS DEC_CEDIS_CY_AMT
		, 0 AS DEC_CEDIS_LY_AMT
		, 0 AS THROW_AWAY_CY_AMT
		, 0 AS THROW_AWAY_LY_AMT

		, 0 AS OFC_INC_CY_AMT
		, 0 AS PRICE_CHNG_TO_0_CY_AMT
		, 0 AS DONATIONS_CY_AMT
		, 0 AS DONATED_CY_AMT
		, 0 AS LQDTNS_CY_AMT
		, 0 AS ABSLT_CP_SHOP_CY_AMT
		, 0 AS EVENT_5000_CY_AMT
		, 0 AS MULTISAVING_CY_AMT
		, 0 AS NBB_CY_AMT
		, 0 AS OFC_SALES_CY_AMT

		, 0 AS OFC_INC_LY_AMT
		, 0 AS PRICE_CHNG_TO_0_LY_AMT
		, 0 AS DONATIONS_LY_AMT
		, 0 AS DONATED_LY_AMT
		, 0 AS LQDTNS_LY_AMT
		, 0 AS ABSLT_CP_SHOP_LY_AMT
		, 0 AS EVENT_5000_LY_AMT
		, 0 AS MULTISAVING_LY_AMT
		, 0 AS NBB_LY_AMT
		, 0 AS OFC_SALES_LY_AMT

		, 0 AS ONHAND_COST_LY_AMT
		, 0 AS ONHAND_COST_CY_AMT
		, 0 AS INTRAN_COST_LY_AMT
		, 0 AS INTRAN_COST_CY_AMT
		, 0 AS INWH_COST_LY_AMT
		, 0 AS INWH_COST_CY_AMT

		, 0 AS CUST_LY_TOT_UNIT_QTY
		, 0 AS CUST_CY_TOT_UNIT_QTY
		, 0 AS CUST_LY_EQ_UNIT_QTY
		, 0 AS CUST_CY_EQ_UNIT_QTY
		, 0 AS TKT_SALE_LY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_CY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_LY_EQ_UNIT_AMT
		, 0 AS TKT_SALE_CY_EQ_UNIT_AMT
		, 0 AS TKT_LY_TOT_UNIT_QTY
		, 0 AS TKT_CY_TOT_UNIT_QTY
		, 0 AS TKT_LY_EQ_UNIT_QTY
		, 0 AS TKT_CY_EQ_UNIT_QTY

		, VISIT_CAL_LY_DT 
		, VISIT_CY_DT
	FROM $src_schema_mx_reporting.$src_table_visit_scan_wmt_tot SCAN
	WHERE SCAN.VISIT_CY_DT BETWEEN $beg_date AND $end_date
	GROUP BY
		 YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, DEPT_DESC
		, DEPT_NBR
		, SALE_TYPE_IND
		, VISIT_CAL_LY_DT
		, VISIT_CY_DT
	
	UNION ALL

	SELECT 
		 YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, DEPT_DESC
		, DEPT_NBR
		, -999 AS SALE_TYPE_IND

		, 0 AS SALE_CY_EQ_UNIT_AMT
		, 0 AS SALE_CY_TOT_UNIT_AMT
		, 0 AS SALE_CY_EQ_UNIT_QTY
		, 0 AS SALE_CY_TOT_UNIT_QTY
		, 0 AS SALE_COMP_LY_EQ_UNIT_AMT
		, 0 AS SALE_COMP_LY_TOT_UNIT_AMT
		, 0 AS SALE_COMP_LY_EQ_UNIT_QTY
		, 0 AS SALE_COMP_LY_TOT_UNIT_QTY
		, 0 AS SALE_CAL_LY_EQ_UNIT_AMT
		, 0 AS SALE_CAL_LY_TOT_UNIT_AMT
		, 0 AS SALE_CAL_LY_EQ_UNIT_QTY
		, 0 AS SALE_CAL_LY_TOT_UNIT_QTY

		, SUM(SHIP_COST_CY_AMT) AS SHIP_COST_CY_AMT
		, SUM(SHIP_COST_LY_AMT) AS SHIP_COST_LY_AMT
		, SUM(SHIP_RTL_CY_AMT) AS SHIP_RTL_CY_AMT
		, SUM(SHIP_RTL_LY_AMT) AS SHIP_RTL_LY_AMT
    
		, 0 AS RTN_COST_CY_AMT
		, 0 AS RTN_COST_LY_AMT
		, 0 AS RTN_RTL_CY_AMT
		, 0 AS RTN_RTL_LY_AMT

		, 0 AS DEC_CEDIS_CY_AMT
		, 0 AS DEC_CEDIS_LY_AMT
		, 0 AS THROW_AWAY_CY_AMT
		, 0 AS THROW_AWAY_LY_AMT

		, 0 AS OFC_INC_CY_AMT
		, 0 AS PRICE_CHNG_TO_0_CY_AMT
		, 0 AS DONATIONS_CY_AMT
		, 0 AS DONATED_CY_AMT
		, 0 AS LQDTNS_CY_AMT
		, 0 AS ABSLT_CP_SHOP_CY_AMT
		, 0 AS EVENT_5000_CY_AMT
		, 0 AS MULTISAVING_CY_AMT
		, 0 AS NBB_CY_AMT
		, 0 AS OFC_SALES_CY_AMT

		, 0 AS OFC_INC_LY_AMT
		, 0 AS PRICE_CHNG_TO_0_LY_AMT
		, 0 AS DONATIONS_LY_AMT
		, 0 AS DONATED_LY_AMT
		, 0 AS LQDTNS_LY_AMT
		, 0 AS ABSLT_CP_SHOP_LY_AMT
		, 0 AS EVENT_5000_LY_AMT
		, 0 AS MULTISAVING_LY_AMT
		, 0 AS NBB_LY_AMT
		, 0 AS OFC_SALES_LY_AMT

		, 0 AS ONHAND_COST_LY_AMT
		, 0 AS ONHAND_COST_CY_AMT
		, 0 AS INTRAN_COST_LY_AMT
		, 0 AS INTRAN_COST_CY_AMT
		, 0 AS INWH_COST_LY_AMT
		, 0 AS INWH_COST_CY_AMT

		, 0 AS CUST_LY_TOT_UNIT_QTY
		, 0 AS CUST_CY_TOT_UNIT_QTY
		, 0 AS CUST_LY_EQ_UNIT_QTY
		, 0 AS CUST_CY_EQ_UNIT_QTY
		, 0 AS TKT_SALE_LY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_CY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_LY_EQ_UNIT_AMT
		, 0 AS TKT_SALE_CY_EQ_UNIT_AMT
		, 0 AS TKT_LY_TOT_UNIT_QTY
		, 0 AS TKT_CY_TOT_UNIT_QTY
		, 0 AS TKT_LY_EQ_UNIT_QTY
		, 0 AS TKT_CY_EQ_UNIT_QTY

		, BUS_LY_DT AS VISIT_CAL_LY_DT 
		, BUS_CY_DT AS VISIT_CY_DT		

	FROM $src_schema_mx_reporting.$src_table_ship_wmt_tot
	WHERE BUS_CY_DT BETWEEN $beg_date AND $end_date
	GROUP BY
		 YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, DEPT_DESC
		, DEPT_NBR
		, -999
		, BUS_LY_DT
		, BUS_CY_DT

	UNION ALL

	SELECT 
		 YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, DEPT_DESC
		, DEPT_NBR
		, -999 AS SALE_TYPE_IND

		, 0 AS SALE_CY_EQ_UNIT_AMT
		, 0 AS SALE_CY_TOT_UNIT_AMT
		, 0 AS SALE_CY_EQ_UNIT_QTY
		, 0 AS SALE_CY_TOT_UNIT_QTY
		, 0 AS SALE_COMP_LY_EQ_UNIT_AMT
		, 0 AS SALE_COMP_LY_TOT_UNIT_AMT
		, 0 AS SALE_COMP_LY_EQ_UNIT_QTY
		, 0 AS SALE_COMP_LY_TOT_UNIT_QTY
		, 0 AS SALE_CAL_LY_EQ_UNIT_AMT
		, 0 AS SALE_CAL_LY_TOT_UNIT_AMT
		, 0 AS SALE_CAL_LY_EQ_UNIT_QTY
		, 0 AS SALE_CAL_LY_TOT_UNIT_QTY

		, 0 AS SHIP_COST_CY_AMT
		, 0 AS SHIP_COST_LY_AMT
		, 0 AS SHIP_RTL_CY_AMT
		, 0 AS SHIP_RTL_LY_AMT
    
		, SUM(RTN_COST_CY_AMT) AS RTN_COST_CY_AMT
		, SUM(RTN_RTL_CY_AMT) AS RTN_RTL_CY_AMT
		, SUM(RTN_COST_LY_AMT) AS RTN_COST_LY_AMT
		, SUM(RTN_RTL_LY_AMT) AS RTN_RTL_LY_AMT

		, 0 AS DEC_CEDIS_CY_AMT
		, 0 AS DEC_CEDIS_LY_AMT
		, 0 AS THROW_AWAY_CY_AMT
		, 0 AS THROW_AWAY_LY_AMT

		, 0 AS OFC_INC_CY_AMT
		, 0 AS PRICE_CHNG_TO_0_CY_AMT
		, 0 AS DONATIONS_CY_AMT
		, 0 AS DONATED_CY_AMT
		, 0 AS LQDTNS_CY_AMT
		, 0 AS ABSLT_CP_SHOP_CY_AMT
		, 0 AS EVENT_5000_CY_AMT
		, 0 AS MULTISAVING_CY_AMT
		, 0 AS NBB_CY_AMT
		, 0 AS OFC_SALES_CY_AMT

		, 0 AS OFC_INC_LY_AMT
		, 0 AS PRICE_CHNG_TO_0_LY_AMT
		, 0 AS DONATIONS_LY_AMT
		, 0 AS DONATED_LY_AMT
		, 0 AS LQDTNS_LY_AMT
		, 0 AS ABSLT_CP_SHOP_LY_AMT
		, 0 AS EVENT_5000_LY_AMT
		, 0 AS MULTISAVING_LY_AMT
		, 0 AS NBB_LY_AMT
		, 0 AS OFC_SALES_LY_AMT

		, 0 AS ONHAND_COST_LY_AMT
		, 0 AS ONHAND_COST_CY_AMT
		, 0 AS INTRAN_COST_LY_AMT
		, 0 AS INTRAN_COST_CY_AMT
		, 0 AS INWH_COST_LY_AMT
		, 0 AS INWH_COST_CY_AMT

		, 0 AS CUST_LY_TOT_UNIT_QTY
		, 0 AS CUST_CY_TOT_UNIT_QTY
		, 0 AS CUST_LY_EQ_UNIT_QTY
		, 0 AS CUST_CY_EQ_UNIT_QTY
		, 0 AS TKT_SALE_LY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_CY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_LY_EQ_UNIT_AMT
		, 0 AS TKT_SALE_CY_EQ_UNIT_AMT
		, 0 AS TKT_LY_TOT_UNIT_QTY
		, 0 AS TKT_CY_TOT_UNIT_QTY
		, 0 AS TKT_LY_EQ_UNIT_QTY
		, 0 AS TKT_CY_EQ_UNIT_QTY

		, RTN_LY_DT AS VISIT_CAL_LY_DT 
		, RTN_CY_DT	AS VISIT_CY_DT

	FROM $src_schema_mx_reporting.$src_table_rtn_wmt_tot
	WHERE RTN_CY_DT BETWEEN $beg_date AND $end_date
	GROUP BY 
		YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, DEPT_DESC
		, DEPT_NBR
		, -999
		, RTN_LY_DT
		, RTN_CY_DT

	UNION ALL

	SELECT 
		 YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, DEPT_DESC
		, DEPT_NBR
		, -999 AS SALE_TYPE_IND

		, 0 AS SALE_CY_EQ_UNIT_AMT
		, 0 AS SALE_CY_TOT_UNIT_AMT
		, 0 AS SALE_CY_EQ_UNIT_QTY
		, 0 AS SALE_CY_TOT_UNIT_QTY
		, 0 AS SALE_COMP_LY_EQ_UNIT_AMT
		, 0 AS SALE_COMP_LY_TOT_UNIT_AMT
		, 0 AS SALE_COMP_LY_EQ_UNIT_QTY
		, 0 AS SALE_COMP_LY_TOT_UNIT_QTY
		, 0 AS SALE_CAL_LY_EQ_UNIT_AMT
		, 0 AS SALE_CAL_LY_TOT_UNIT_AMT
		, 0 AS SALE_CAL_LY_EQ_UNIT_QTY
		, 0 AS SALE_CAL_LY_TOT_UNIT_QTY

		, 0 AS SHIP_COST_CY_AMT
		, 0 AS SHIP_COST_LY_AMT
		, 0 AS SHIP_RTL_CY_AMT
		, 0 AS SHIP_RTL_LY_AMT
    
		, 0 AS RTN_COST_CY_AMT
		, 0 AS RTN_COST_LY_AMT
		, 0 AS RTN_RTL_CY_AMT
		, 0 AS RTN_RTL_LY_AMT

		, SUM(DEC_CEDIS_CY_AMT) AS DEC_CEDIS_CY_AMT
		, SUM(DEC_CEDIS_LY_AMT) AS DEC_CEDIS_LY_AMT
		, SUM(THROW_AWAY_CY_AMT) AS THROW_AWAY_CY_AMT
		, SUM(THROW_AWAY_LY_AMT) AS THROW_AWAY_LY_AMT

		, 0 AS OFC_INC_CY_AMT
		, 0 AS PRICE_CHNG_TO_0_CY_AMT
		, 0 AS DONATIONS_CY_AMT
		, 0 AS DONATED_CY_AMT
		, 0 AS LQDTNS_CY_AMT
		, 0 AS ABSLT_CP_SHOP_CY_AMT
		, 0 AS EVENT_5000_CY_AMT
		, 0 AS MULTISAVING_CY_AMT
		, 0 AS NBB_CY_AMT
		, 0 AS OFC_SALES_CY_AMT

		, 0 AS OFC_INC_LY_AMT
		, 0 AS PRICE_CHNG_TO_0_LY_AMT
		, 0 AS DONATIONS_LY_AMT
		, 0 AS DONATED_LY_AMT
		, 0 AS LQDTNS_LY_AMT
		, 0 AS ABSLT_CP_SHOP_LY_AMT
		, 0 AS EVENT_5000_LY_AMT
		, 0 AS MULTISAVING_LY_AMT
		, 0 AS NBB_LY_AMT
		, 0 AS OFC_SALES_LY_AMT

		, 0 AS ONHAND_COST_LY_AMT
		, 0 AS ONHAND_COST_CY_AMT
		, 0 AS INTRAN_COST_LY_AMT
		, 0 AS INTRAN_COST_CY_AMT
		, 0 AS INWH_COST_LY_AMT
		, 0 AS INWH_COST_CY_AMT

		, 0 AS CUST_LY_TOT_UNIT_QTY
		, 0 AS CUST_CY_TOT_UNIT_QTY
		, 0 AS CUST_LY_EQ_UNIT_QTY
		, 0 AS CUST_CY_EQ_UNIT_QTY
		, 0 AS TKT_SALE_LY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_CY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_LY_EQ_UNIT_AMT
		, 0 AS TKT_SALE_CY_EQ_UNIT_AMT
		, 0 AS TKT_LY_TOT_UNIT_QTY
		, 0 AS TKT_CY_TOT_UNIT_QTY
		, 0 AS TKT_LY_EQ_UNIT_QTY
		, 0 AS TKT_CY_EQ_UNIT_QTY

		, INVT_ADJ_LY_DT AS VISIT_CAL_LY_DT 
		, INVT_ADJ_CY_DT AS VISIT_CY_DT

	FROM $src_schema_mx_reporting.$src_table_decrease_wmt_tot TOT
	WHERE INVT_ADJ_CY_DT BETWEEN $beg_date AND $end_date
	GROUP BY 
		YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC		
		, DEPT_DESC
		, DEPT_NBR
		, -999
		, INVT_ADJ_LY_DT
		, INVT_ADJ_CY_DT

	UNION ALL

	SELECT 
		 YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, DEPT_DESC
		, DEPT_NBR
		, -999 AS SALE_TYPE_IND

		, 0 AS SALE_CY_EQ_UNIT_AMT
		, 0 AS SALE_CY_TOT_UNIT_AMT
		, 0 AS SALE_CY_EQ_UNIT_QTY
		, 0 AS SALE_CY_TOT_UNIT_QTY
		, 0 AS SALE_COMP_LY_EQ_UNIT_AMT
		, 0 AS SALE_COMP_LY_TOT_UNIT_AMT
		, 0 AS SALE_COMP_LY_EQ_UNIT_QTY
		, 0 AS SALE_COMP_LY_TOT_UNIT_QTY
		, 0 AS SALE_CAL_LY_EQ_UNIT_AMT
		, 0 AS SALE_CAL_LY_TOT_UNIT_AMT
		, 0 AS SALE_CAL_LY_EQ_UNIT_QTY
		, 0 AS SALE_CAL_LY_TOT_UNIT_QTY

		, 0 AS SHIP_COST_CY_AMT
		, 0 AS SHIP_COST_LY_AMT
		, 0 AS SHIP_RTL_CY_AMT
		, 0 AS SHIP_RTL_LY_AMT
    
		, 0 AS RTN_COST_CY_AMT
		, 0 AS RTN_RTL_CY_AMT
		, 0 AS RTN_COST_LY_AMT
		, 0 AS RTN_RTL_LY_AMT

		, 0 AS DEC_CEDIS_CY_AMT
		, 0 AS DEC_CEDIS_LY_AMT
		, 0 AS THROW_AWAY_CY_AMT
		, 0 AS THROW_AWAY_LY_AMT		
		
		, SUM(OFC_INC_CY_AMT) AS OFC_INC_CY_AMT
		, SUM(PRICE_CHNG_TO_0_CY_AMT) AS PRICE_CHNG_TO_0_CY_AMT
		, SUM(DONATIONS_CY_AMT) AS DONATIONS_CY_AMT
		, SUM(DONATED_CY_AMT) AS DONATED_CY_AMT
		, SUM(LQDTNS_CY_AMT) AS LQDTNS_CY_AMT
		, SUM(ABSLT_CP_SHOP_CY_AMT) AS ABSLT_CP_SHOP_CY_AMT
		, SUM(EVENT_5000_CY_AMT) AS EVENT_5000_CY_AMT
		, SUM(MULTISAVING_CY_AMT) AS MULTISAVING_CY_AMT
		, SUM(NBB_CY_AMT) AS NBB_CY_AMT
		, SUM(OFC_SALES_CY_AMT) AS OFC_SALES_CY_AMT

		, SUM(OFC_INC_LY_AMT) AS OFC_INC_LY_AMT
		, SUM(PRICE_CHNG_TO_0_LY_AMT) AS PRICE_CHNG_TO_0_LY_AMT
		, SUM(DONATIONS_LY_AMT) AS DONATIONS_LY_AMT
		, SUM(DONATED_LY_AMT) AS DONATED_LY_AMT
		, SUM(LQDTNS_LY_AMT) AS LQDTNS_LY_AMT
		, SUM(ABSLT_CP_SHOP_LY_AMT) AS ABSLT_CP_SHOP_LY_AMT
		, SUM(EVENT_5000_LY_AMT) AS EVENT_5000_LY_AMT
		, SUM(MULTISAVING_LY_AMT) AS MULTISAVING_LY_AMT
		, SUM(NBB_LY_AMT) AS NBB_LY_AMT
		, SUM(OFC_SALES_LY_AMT) AS OFC_SALES_LY_AMT

		, 0 AS ONHAND_COST_LY_AMT
		, 0 AS ONHAND_COST_CY_AMT
		, 0 AS INTRAN_COST_LY_AMT
		, 0 AS INTRAN_COST_CY_AMT
		, 0 AS INWH_COST_LY_AMT
		, 0 AS INWH_COST_CY_AMT

		, 0 AS CUST_LY_TOT_UNIT_QTY
		, 0 AS CUST_CY_TOT_UNIT_QTY
		, 0 AS CUST_LY_EQ_UNIT_QTY
		, 0 AS CUST_CY_EQ_UNIT_QTY
		, 0 AS TKT_SALE_LY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_CY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_LY_EQ_UNIT_AMT
		, 0 AS TKT_SALE_CY_EQ_UNIT_AMT
		, 0 AS TKT_LY_TOT_UNIT_QTY
		, 0 AS TKT_CY_TOT_UNIT_QTY
		, 0 AS TKT_LY_EQ_UNIT_QTY
		, 0 AS TKT_CY_EQ_UNIT_QTY

		, MUMD_LY_DT AS VISIT_CAL_LY_DT 
		, MUMD_CY_DT AS VISIT_CY_DT

	FROM $src_schema_mx_reporting.$src_table_mumd_wmt_tot
	WHERE MUMD_CY_DT BETWEEN $beg_date AND $end_date
	GROUP BY 
		YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC		
		, DEPT_DESC
		, DEPT_NBR
		, -999
		, MUMD_LY_DT
		, MUMD_CY_DT

	UNION ALL

	SELECT 
		 YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, DEPT_DESC
		, DEPT_NBR
		, -999 AS SALE_TYPE_IND

		, 0 AS SALE_CY_EQ_UNIT_AMT
		, 0 AS SALE_CY_TOT_UNIT_AMT
		, 0 AS SALE_CY_EQ_UNIT_QTY
		, 0 AS SALE_CY_TOT_UNIT_QTY
		, 0 AS SALE_COMP_LY_EQ_UNIT_AMT
		, 0 AS SALE_COMP_LY_TOT_UNIT_AMT
		, 0 AS SALE_COMP_LY_EQ_UNIT_QTY
		, 0 AS SALE_COMP_LY_TOT_UNIT_QTY
		, 0 AS SALE_CAL_LY_EQ_UNIT_AMT
		, 0 AS SALE_CAL_LY_TOT_UNIT_AMT
		, 0 AS SALE_CAL_LY_EQ_UNIT_QTY
		, 0 AS SALE_CAL_LY_TOT_UNIT_QTY

		, 0 AS SHIP_COST_CY_AMT
		, 0 AS SHIP_COST_LY_AMT
		, 0 AS SHIP_RTL_CY_AMT
		, 0 AS SHIP_RTL_LY_AMT
    
		, 0 AS RTN_COST_CY_AMT
		, 0 AS RTN_RTL_CY_AMT
		, 0 AS RTN_COST_LY_AMT
		, 0 AS RTN_RTL_LY_AMT

		, 0 AS DEC_CEDIS_CY_AMT
		, 0 AS DEC_CEDIS_LY_AMT
		, 0 AS THROW_AWAY_CY_AMT
		, 0 AS THROW_AWAY_LY_AMT		
		
		, 0 AS OFC_INC_CY_AMT
		, 0 AS PRICE_CHNG_TO_0_CY_AMT
		, 0 AS DONATIONS_CY_AMT
		, 0 AS DONATED_CY_AMT
		, 0 AS LQDTNS_CY_AMT
		, 0 AS ABSLT_CP_SHOP_CY_AMT
		, 0 AS EVENT_5000_CY_AMT
		, 0 AS MULTISAVING_CY_AMT
		, 0 AS NBB_CY_AMT
		, 0 AS OFC_SALES_CY_AMT

		, 0 AS OFC_INC_LY_AMT
		, 0 AS PRICE_CHNG_TO_0_LY_AMT
		, 0 AS DONATIONS_LY_AMT
		, 0 AS DONATED_LY_AMT
		, 0 AS LQDTNS_LY_AMT
		, 0 AS ABSLT_CP_SHOP_LY_AMT
		, 0 AS EVENT_5000_LY_AMT
		, 0 AS MULTISAVING_LY_AMT
		, 0 AS NBB_LY_AMT
		, 0 AS OFC_SALES_LY_AMT		
	
		, SUM(ONHAND_COST_LY_AMT) AS ONHAND_COST_LY_AMT
		, SUM(ONHAND_COST_CY_AMT) AS ONHAND_COST_CY_AMT
		, SUM(INTRAN_COST_LY_AMT) AS INTRAN_COST_LY_AMT
		, SUM(INTRAN_COST_CY_AMT) AS INTRAN_COST_CY_AMT
		, SUM(INWH_COST_LY_AMT) AS INWH_COST_LY_AMT
		, SUM(INWH_COST_CY_AMT) AS INWH_COST_CY_AMT

		, 0 AS CUST_LY_TOT_UNIT_QTY
		, 0 AS CUST_CY_TOT_UNIT_QTY
		, 0 AS CUST_LY_EQ_UNIT_QTY
		, 0 AS CUST_CY_EQ_UNIT_QTY
		, 0 AS TKT_SALE_LY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_CY_TOT_UNIT_AMT
		, 0 AS TKT_SALE_LY_EQ_UNIT_AMT
		, 0 AS TKT_SALE_CY_EQ_UNIT_AMT
		, 0 AS TKT_LY_TOT_UNIT_QTY
		, 0 AS TKT_CY_TOT_UNIT_QTY
		, 0 AS TKT_LY_EQ_UNIT_QTY
		, 0 AS TKT_CY_EQ_UNIT_QTY

		, INVT_LY_DT AS VISIT_CAL_LY_DT 
		, INVT_CY_DT AS VISIT_CY_DT

	FROM $src_schema_mx_reporting.$src_table_invt_wmt_tot
	WHERE INVT_CY_DT BETWEEN $beg_date AND $end_date
	GROUP BY 
		YEAR_NBR
		, MONTH_NBR
		, DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, DEPT_DESC
		, DEPT_NBR
		, -999
		, INVT_LY_DT
		, INVT_CY_DT

	UNION ALL

	SELECT 
		year(VISIT_CY_DT) AS YEAR_NBR
		, month(VISIT_CY_DT) AS  MONTH_NBR
		, day(VISIT_CY_DT) AS DAY_NBR
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC
		, 'XXXX' AS DEPT_DESC
		, -999 AS DEPT_NBR
		, -999 AS SALE_TYPE_IND

		, 0 AS SALE_CY_EQ_UNIT_AMT
		, 0 AS SALE_CY_TOT_UNIT_AMT
		, 0 AS SALE_CY_EQ_UNIT_QTY
		, 0 AS SALE_CY_TOT_UNIT_QTY
		, 0 AS SALE_COMP_LY_EQ_UNIT_AMT
		, 0 AS SALE_COMP_LY_TOT_UNIT_AMT
		, 0 AS SALE_COMP_LY_EQ_UNIT_QTY
		, 0 AS SALE_COMP_LY_TOT_UNIT_QTY
		, 0 AS SALE_CAL_LY_EQ_UNIT_AMT
		, 0 AS SALE_CAL_LY_TOT_UNIT_AMT
		, 0 AS SALE_CAL_LY_EQ_UNIT_QTY
		, 0 AS SALE_CAL_LY_TOT_UNIT_QTY

		, 0 AS SHIP_COST_CY_AMT
		, 0 AS SHIP_COST_LY_AMT
		, 0 AS SHIP_RTL_CY_AMT
		, 0 AS SHIP_RTL_LY_AMT
    
		, 0 AS RTN_COST_CY_AMT
		, 0 AS RTN_RTL_CY_AMT
		, 0 AS RTN_COST_LY_AMT
		, 0 AS RTN_RTL_LY_AMT

		, 0 AS DEC_CEDIS_CY_AMT
		, 0 AS DEC_CEDIS_LY_AMT
		, 0 AS THROW_AWAY_CY_AMT
		, 0 AS THROW_AWAY_LY_AMT		
		
		, 0 AS OFC_INC_CY_AMT
		, 0 AS PRICE_CHNG_TO_0_CY_AMT
		, 0 AS DONATIONS_CY_AMT
		, 0 AS DONATED_CY_AMT
		, 0 AS LQDTNS_CY_AMT
		, 0 AS ABSLT_CP_SHOP_CY_AMT
		, 0 AS EVENT_5000_CY_AMT
		, 0 AS MULTISAVING_CY_AMT
		, 0 AS NBB_CY_AMT
		, 0 AS OFC_SALES_CY_AMT

		, 0 AS OFC_INC_LY_AMT
		, 0 AS PRICE_CHNG_TO_0_LY_AMT
		, 0 AS DONATIONS_LY_AMT
		, 0 AS DONATED_LY_AMT
		, 0 AS LQDTNS_LY_AMT
		, 0 AS ABSLT_CP_SHOP_LY_AMT
		, 0 AS EVENT_5000_LY_AMT
		, 0 AS MULTISAVING_LY_AMT
		, 0 AS NBB_LY_AMT
		, 0 AS OFC_SALES_LY_AMT		
	
		, 0 AS ONHAND_COST_LY_AMT
		, 0 AS ONHAND_COST_CY_AMT
		, 0 AS INTRAN_COST_LY_AMT
		, 0 AS INTRAN_COST_CY_AMT
		, 0 AS INWH_COST_LY_AMT
		, 0 AS INWH_COST_CY_AMT

		, SUM(CUST_LY_TOT_UNIT_QTY) AS CUST_LY_TOT_UNIT_QTY
		, SUM(CUST_CY_TOT_UNIT_QTY) AS CUST_CY_TOT_UNIT_QTY
		, SUM(CUST_LY_EQ_UNIT_QTY) AS CUST_LY_EQ_UNIT_QTY
		, SUM(CUST_CY_EQ_UNIT_QTY) AS CUST_CY_EQ_UNIT_QTY
		, SUM(TKT_SALE_LY_TOT_UNIT_AMT) AS TKT_SALE_LY_TOT_UNIT_AMT
		, SUM(TKT_SALE_CY_TOT_UNIT_AMT) AS TKT_SALE_CY_TOT_UNIT_AMT
		, SUM(TKT_SALE_LY_EQ_UNIT_AMT) AS TKT_SALE_LY_EQ_UNIT_AMT
		, SUM(TKT_SALE_CY_EQ_UNIT_AMT) AS TKT_SALE_CY_EQ_UNIT_AMT
		, SUM(TKT_LY_TOT_UNIT_QTY) AS TKT_LY_TOT_UNIT_QTY
		, SUM(TKT_CY_TOT_UNIT_QTY) AS TKT_CY_TOT_UNIT_QTY
		, SUM(TKT_LY_EQ_UNIT_QTY) AS TKT_LY_EQ_UNIT_QTY
		, SUM(TKT_CY_EQ_UNIT_QTY) AS TKT_CY_EQ_UNIT_QTY

		, VISIT_LY_DT AS VISIT_CAL_LY_DT 
		, VISIT_CY_DT AS VISIT_CY_DT

	FROM $src_schema_mx_reporting.$src_table_tkt_catg_wmt_tot
	WHERE VISIT_CY_DT BETWEEN $beg_date AND $end_date
	GROUP BY 
		year(VISIT_CY_DT)
		, month(VISIT_CY_DT)
		, day(VISIT_CY_DT)
		, BANNER_CD
		, BANNER_DESC
		, CAT_NBR
		, CAT_DESC
		, TRIBE_NBR
		, TRIBE_DESC
		, SQUAD_NBR
		, SQUAD_DESC	
		, 'XXXX'
		, -999
		, -999
		, VISIT_LY_DT
		, VISIT_CY_DT

) X
GROUP BY 
	YEAR_NBR
	, MONTH_NBR
	, DAY_NBR
	, BANNER_CD
	, BANNER_DESC
	, CAT_NBR
	, CAT_DESC
	, TRIBE_NBR
	, TRIBE_DESC
	, SQUAD_NBR
	, SQUAD_DESC
	, DEPT_DESC
	, DEPT_NBR
	, SALE_TYPE_IND
	, VISIT_CAL_LY_DT 
	, VISIT_CY_DT
;

dfs -chgrp -R $group_name /user/hive/.../$target_schema.db/$target_table_sales_trib; 
dfs -chmod -R $permission /user/hive/.../$target_schema.db/$target_table_sales_trib;
"